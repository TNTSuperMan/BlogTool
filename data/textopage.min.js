let tmp=null,debug=!1,e=e=>document.createElement(e),log=console.log,err=debug?console.error:null;function Get(e){let t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t}async function LoadPage(t,n){for(let o=0;o<n.length;++o)switch(n[o][0]){case":":let i=n[o].split(":");if(3!==i.length){err(o+1+" Line :xxx~ define incorrect\n"+n[o]);continue}let r=e(i[1]);for(r.innerText=i[2];n.length-1>o&&0!==n[o+1].length&&"="===n[o+1][0]&&3===n[o+1].split("=").length;)o++,i=n[o].replace("\r","").split("="),r.setAttribute(i[1],i[2]);t.append(r);break;case";":let l=n[o].split(";");if(l.length<3){err(o+1+"Line ;xx~ define incorrect\n"+n[o]);continue}let a=tmp.id.indexOf(l[1]);if(-1===a){err(o+1+" Line ;xxx~ define incorrect\n"+n[o]);continue}let p=tmp.temp[a];for(let e=0;e<l.length-2;++e)p=p.replace("%",l[2+e]);LoadPage(t,p.split("\n"));break;case"<":case"&":t.innerHTML+=n[o]}}async function optocf(t,n){fetch(n).then((async function(o){if(!o.ok)return err("Not Found PageFile: "+n),void lm(404);let i=e("z");LoadPage(i,(await o.text()).split("\n")),$(t).html(i.innerHTML)}))}async function lm(t){if(null==tmp){let t=$("body"),n=Get("/config/temp.json");if(200!==n.status)return void err("Not Found Template Configfile");tmp={id:[],temp:[]},JSON.parse(n.responseText).forEach((e=>{tmp.id.push(e.id),tmp.temp.push(e.base)})),t.append(e("header")),t.append(e("main")),t.append(e("footer")),$("head").append(e("title")),optocf("header","/page/header.page"),optocf("footer","/page/footer.page"),document.body.innerHTML+='<a href="https://github.com/TNTSuperMan/TextoPage.js" target="_blank">Powered by TextoPage.js</a>'}let n="/page/"+t+".page";fetch(n).then((async function(t){if(!t.ok)return err("Not Found PageFile: "+n),void lm(404);let o=(await t.text()).split("\n");$("title").text(o[0]);let i=e("z");LoadPage(i,o),$("main").html(i.innerHTML)})),history.replaceState("","","?p="+t)}$((function(){var e=window.location.search,t=new Object;if(e)for(var n=(e=e.substring(1)).split("&"),o=0;o<n.length;o++){var i=n[o].split("="),r=decodeURIComponent(i[0]),l=decodeURIComponent(i[1]);t[r]=l}if(t.p){if(lm(t.p),t.s){const e=document.querySelector("#"+t.s);window.scrollTo(0,e.getBoundingClientRect().y)}}else lm(1)}));